{
    "version": "https://jsonfeed.org/version/1",
    "title": "Queek blog • All posts by \"linux部署前后端\" tag",
    "description": "like dream",
    "home_page_url": "https://queek.cn",
    "items": [
        {
            "id": "https://queek.cn/2025/01/11/linux%E9%83%A8%E7%BD%B2%E5%89%8D%E5%90%8E%E7%AB%AF/",
            "url": "https://queek.cn/2025/01/11/linux%E9%83%A8%E7%BD%B2%E5%89%8D%E5%90%8E%E7%AB%AF/",
            "title": "linux部署前后端",
            "date_published": "2025-01-11T15:14:04.000Z",
            "content_html": "<h3 id=\"部署后端\"><a href=\"#部署后端\" class=\"headerlink\" title=\"部署后端\"></a>部署后端</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">前言：</span><br><span class=\"line\"></span><br><span class=\"line\">使用 Ubuntu 系统</span><br><span class=\"line\"></span><br><span class=\"line\">腾讯云内外网互通</span><br><span class=\"line\"></span><br><span class=\"line\">可以通过外网ip访问内网服务器上部署的网站和资源。</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装必要依赖\"><a href=\"#安装必要依赖\" class=\"headerlink\" title=\"安装必要依赖\"></a>安装必要依赖</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 我们后端使用的是python ，因此这里展示python后端代码的部署</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 更新系统软件包</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> apt update</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装依赖</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> apt install -y build-essential checkinstall libssl-dev zlib1g-dev libbz2-dev \\ libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev libncursesw5-dev \\ libffi-dev liblzma-dev tk-dev</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 下载指定版本的python 尽量跟本地版本保持一致</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> wget https://www.python.org/ftp/python/3.10.7/Python-3.10.7.tgz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 解压</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> tar -xvzf Python-3.10.0.tgz</span><br><span class=\"line\"><span class=\"comment\"># 进入安装目录</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> Python-3.10.0</span><br><span class=\"line\"><span class=\"comment\"># 编译及安装</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> ./configure --enable-optimizations</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> make altinstall</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装mysql相关依赖文件</span></span><br><span class=\"line\"><span class=\"comment\"># pkg-config 和 libmysqlclient-dev，这两个包分别用于帮助编译时查找库文件的位置和提供 MySQL 客户端开发所需的库文件</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> apt install pkg-config libmysqlclient-dev</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建虚拟环境</span></span><br><span class=\"line\">python3 -m venv venv</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 进入虚拟环境</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> venv/bin/activate</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 在虚拟环境中安装pip</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> apt update</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> apt install -y python3 python3-pip</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定pip软连接 目的是全局能够访问</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">ln</span> -s /usr/local/bin/pip3 /usr/bin/pip</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 本地代码中执行 生成项目依赖文件</span></span><br><span class=\"line\">pip freeze &gt; requirements.txt </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 进入项目代码层级 安装项目依赖</span></span><br><span class=\"line\">pip install -r requirements.txt</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装配置uwsgi\"><a href=\"#安装配置uwsgi\" class=\"headerlink\" title=\"安装配置uwsgi\"></a>安装配置uwsgi</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># uWSGI 是一个用于部署 Web 应用程序的服务器，它主要被设计用来托管 Python 应用程序，但也可以支持其他语言（如 Ruby、PHP 等）</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 在settings.py同级文件创建uwsgi.ini文件</span></span><br><span class=\"line\"></span><br><span class=\"line\">[uwsgi]</span><br><span class=\"line\"><span class=\"built_in\">chdir</span>=/home/lighthouse/workspace/muxi_shop_api2/</span><br><span class=\"line\">module=mu_shop_api.wsgi:application</span><br><span class=\"line\">master=True</span><br><span class=\"line\">pidfile=/home/lighthouse/workspace/muxi_shop_api2/project-master.pid</span><br><span class=\"line\">vacuum=True</span><br><span class=\"line\">max-requests=5000</span><br><span class=\"line\">daemonize=/home/lighthouse/workspace/muxi_shop_api2/log/uwsgi/muxishop.log</span><br><span class=\"line\">http-socket= :8000</span><br><span class=\"line\">static-map=/static/product_images=/home/lighthouse/workspace/muxi_shop_api2/static/product_images/</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装uwsgi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> apt install -y uwsgi uwsgi-plugin-python3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启动uwsgi</span></span><br><span class=\"line\">/home/lighthouse/workspace/muxi_shop_api2/venv/bin/uwsgi --ini /home/lighthouse/workspace/muxi_shop_api2/mu_shop_api/uwsgi.ini</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 停止</span></span><br><span class=\"line\">/home/lighthouse/workspace/muxi_shop_api2/venv/bin/uwsgi --stop /home/lighthouse/workspace/muxi_shop_api2/project-master.pid</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"打包代码\"><a href=\"#打包代码\" class=\"headerlink\" title=\"打包代码\"></a>打包代码</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 打包将会忽略 .gitignore中的外部库</span></span><br><span class=\"line\">git ls-files -z | tar --null -czvf muxi_shop_api2.tar.gz -T -</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 打包后的文件</span></span><br><span class=\"line\">muxi_shop_api2.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 服务器中同步创建文件夹并添加权限</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">mkdir</span> muxi_shop_api2</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">chmod</span> -R 775 /home/lighthouse/workspace/muxi_shop_api2/mu_shop_api/</span><br><span class=\"line\"><span class=\"comment\"># 因为增加了权限可能还是无权限写入，因此更改所有者</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">chown</span> -R lighthouse:lighthouse /home/lighthouse/workspace/muxi_shop_api2/mu_shop_api/</span><br><span class=\"line\"><span class=\"comment\"># 上传至服务器</span></span><br><span class=\"line\">scp muxi_shop_api2.tar.gz lighthouse@43.163.113.67:/home/lighthouse/workspace/muxi_shop_api2.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 解压代码</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> tar -xzvf muxi_shop_api2.tar.gz -C /workspace/muxi_shop_api2/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 进入代码的uwsgi.ini 文件目录启动</span></span><br><span class=\"line\">/home/lighthouse/workspace/muxi_shop_api2/mu_shop_api/venv/bin/uwsgi --ini /home/lighthouse/workspace/muxi_shop_api2/mu_shop_api/uwsgi.ini --reload /tmp/uwsgi.pid</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重启uwsgi</span></span><br><span class=\"line\">/home/lighthouse/workspace/muxi_shop_api2/mu_shop_api/venv/bin/uwsgi --ini /home/lighthouse/workspace/muxi_shop_api2/mu_shop_api/uwsgi.ini</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 停止uwsgi</span></span><br><span class=\"line\">/home/lighthouse/workspace/muxi_shop_api2/mu_shop_api/venv/bin/uwsgi --stop /home/lighthouse/workspace/muxi_shop_api2/project-master.pid</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># **** 授权各级目录 重要 ****</span></span><br><span class=\"line\"><span class=\"comment\"># 一定要对各级目录进行授权 否则linux服务器无权限访问项目静态资源文件</span></span><br><span class=\"line\"><span class=\"comment\"># 授权还是提示无权限就改所有者</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用nginx反向代理绑定域名\"><a href=\"#使用nginx反向代理绑定域名\" class=\"headerlink\" title=\"使用nginx反向代理绑定域名\"></a>使用nginx反向代理绑定域名</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    <span class=\"comment\"># 指定域名 注意 一定要后端代码各级目录进行授权 否则无法访问相应文件夹下的代码！！！</span></span><br><span class=\"line\">    server_name queek.work;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># /api/前缀 子集域名 来区分后端的请求地址</span></span><br><span class=\"line\">    location /api/ &#123;</span><br><span class=\"line\">        proxy_pass http://localhost:8000/;</span><br><span class=\"line\">        proxy_set_header Host <span class=\"variable\">$host</span>;</span><br><span class=\"line\">        proxy_set_header X-Real-IP <span class=\"variable\">$remote_addr</span>;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-For <span class=\"variable\">$proxy_add_x_forwarded_for</span>;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-Proto <span class=\"variable\">$scheme</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    location /static/product_images/ &#123;</span><br><span class=\"line\">        <span class=\"built_in\">alias</span> /home/lighthouse/workspace/muxi_shop_api2/static/product_images/;</span><br><span class=\"line\">        expires max;</span><br><span class=\"line\">        add_header Cache-Control <span class=\"string\">&quot;public&quot;</span>;</span><br><span class=\"line\">        try_files <span class=\"variable\">$uri</span> <span class=\"variable\">$uri</span>/ =404;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 这样 我们就能通过域名 queek.work/api/访问后端接口了</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"部署前端\"><a href=\"#部署前端\" class=\"headerlink\" title=\"部署前端\"></a>部署前端</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 打包得到dist文件</span></span><br><span class=\"line\">yarn run build </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用rsync上传</span></span><br><span class=\"line\">rsync -avz -e ssh dist/ lighthouse@43.163.113.67:/home/lighthouse/workspace/small_u-shopping_mall/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 或者scp上传</span></span><br><span class=\"line\"><span class=\"comment\"># scp -r 为递归传输</span></span><br><span class=\"line\">scp -r dist/ lighthouse@43.163.113.67:/home/lighthouse/workspace/small_u-shopping_mall/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 由于我们上传的是文件夹 因此不需要解压</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"使用niginx将域名指向我们的前端静态文件\"><a href=\"#使用niginx将域名指向我们的前端静态文件\" class=\"headerlink\" title=\"使用niginx将域名指向我们的前端静态文件\"></a>使用niginx将域名指向我们的前端静态文件</h4><h4 id=\"启用新的niginx配置文件\"><a href=\"#启用新的niginx配置文件\" class=\"headerlink\" title=\"启用新的niginx配置文件\"></a>启用新的niginx配置文件</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 备份旧的配置文件</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">cp</span> /etc/nginx/sites-available/default /etc/nginx/sites-available/default.bak</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 禁用旧的配置文件（删除符号链接）</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">rm</span> /etc/nginx/sites-enabled/default</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启用新的配置文件</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">ln</span> -s /etc/nginx/sites-available/queek.work /etc/nginx/sites-enabled/</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"最终文件\"><a href=\"#最终文件\" class=\"headerlink\" title=\"最终文件\"></a>最终文件</h5><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> nano /etc/nginx/sites-available/queek.work</span><br><span class=\"line\"> </span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    server_name queek.work;</span><br><span class=\"line\"></span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">    <span class=\"comment\"># 要各级文件目录进行授权</span></span><br><span class=\"line\">        <span class=\"built_in\">alias</span> /home/lighthouse/workspace/small_u-shopping_mall/;  <span class=\"comment\"># 这是你上传 dist 文件夹的路径</span></span><br><span class=\"line\">        index index.html;</span><br><span class=\"line\">        try_files <span class=\"variable\">$uri</span> /index.html;  <span class=\"comment\"># Vue SPA路由需要此配置</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    location /api/ &#123;</span><br><span class=\"line\">        proxy_pass http://localhost:8000/;</span><br><span class=\"line\">        proxy_set_header Host <span class=\"variable\">$host</span>;</span><br><span class=\"line\">        proxy_set_header X-Real-IP <span class=\"variable\">$remote_addr</span>;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-For <span class=\"variable\">$proxy_add_x_forwarded_for</span>;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-Proto <span class=\"variable\">$scheme</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    location /static/product_images/ &#123;</span><br><span class=\"line\">        <span class=\"built_in\">alias</span> /home/lighthouse/workspace/muxi_shop_api2/static/product_images/;</span><br><span class=\"line\">        expires max;</span><br><span class=\"line\">        add_header Cache-Control <span class=\"string\">&quot;public&quot;</span>;</span><br><span class=\"line\">        try_files <span class=\"variable\">$uri</span> <span class=\"variable\">$uri</span>/ =404;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 现在我们就能通过域名访问前端网站了</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动niginx\"><a href=\"#启动niginx\" class=\"headerlink\" title=\"启动niginx\"></a>启动niginx</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看配置文件状态</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> nginx -t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#重启动nginx</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl reload nginx</span><br><span class=\"line\"><span class=\"comment\">#重启动nginx</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl restart nginx</span><br><span class=\"line\"><span class=\"comment\">#启动nginx</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl start nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 如果启动后访问有错误 可以查看日志</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">tail</span> -f /var/log/nginx/access.log</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"加入证书\"><a href=\"#加入证书\" class=\"headerlink\" title=\"加入证书\"></a>加入证书</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lighthouse@VM-0-8-ubuntu:~$ <span class=\"built_in\">sudo</span> <span class=\"built_in\">cat</span> /etc/nginx/sites-available/queek.work</span><br><span class=\"line\"><span class=\"comment\"># HTTP 请求重定向到 HTTPS</span></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable\">$host</span> = www.queek.work) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">return</span> 301 https://$host<span class=\"variable\">$request_uri</span>;</span><br><span class=\"line\">    &#125; <span class=\"comment\"># managed by Certbot</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable\">$host</span> = queek.work) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">return</span> 301 https://$host<span class=\"variable\">$request_uri</span>;</span><br><span class=\"line\">    &#125; <span class=\"comment\"># managed by Certbot</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    server_name queek.work www.queek.work;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 强制所有 HTTP 请求重定向到 HTTPS</span></span><br><span class=\"line\">    <span class=\"built_in\">return</span> 301 https://$host<span class=\"variable\">$request_uri</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># HTTPS 配置</span></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 443 ssl;</span><br><span class=\"line\">    server_name queek.work www.queek.work;</span><br><span class=\"line\">    ssl_certificate /etc/letsencrypt/live/queek.work/fullchain.pem; <span class=\"comment\"># managed by Certbot</span></span><br><span class=\"line\"> <span class=\"comment\"># 证书路径</span></span><br><span class=\"line\">    ssl_certificate_key /etc/letsencrypt/live/queek.work/privkey.pem; <span class=\"comment\"># managed by Certbot</span></span><br><span class=\"line\"> <span class=\"comment\"># 私钥路径</span></span><br><span class=\"line\"></span><br><span class=\"line\">    ssl_protocols TLSv1.2 TLSv1.3;</span><br><span class=\"line\">    ssl_prefer_server_ciphers on;</span><br><span class=\"line\">    ssl_ciphers <span class=\"string\">&quot;EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 启用 OCSP stapling</span></span><br><span class=\"line\">    ssl_stapling on;</span><br><span class=\"line\">    ssl_stapling_verify on;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 设置缓存有效期</span></span><br><span class=\"line\">    ssl_session_cache shared:SSL:10m;</span><br><span class=\"line\">    ssl_session_timeout 10m;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 日志设置</span></span><br><span class=\"line\">    access_log /var/log/nginx/queek.work.access.log;</span><br><span class=\"line\">    error_log /var/log/nginx/queek.work.error.log;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 反向代理配置</span></span><br><span class=\"line\">    location /api/ &#123;</span><br><span class=\"line\">        proxy_pass http://localhost:8000/;</span><br><span class=\"line\">        proxy_set_header Host <span class=\"variable\">$host</span>;</span><br><span class=\"line\">        proxy_set_header X-Real-IP <span class=\"variable\">$remote_addr</span>;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-For <span class=\"variable\">$proxy_add_x_forwarded_for</span>;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-Proto <span class=\"variable\">$scheme</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    location /static/product_images/ &#123;</span><br><span class=\"line\">        <span class=\"built_in\">alias</span> /home/lighthouse/workspace/muxi_shop_api2/static/product_images/;</span><br><span class=\"line\">        expires max;</span><br><span class=\"line\">        add_header Cache-Control <span class=\"string\">&quot;public&quot;</span>;</span><br><span class=\"line\">        try_files <span class=\"variable\">$uri</span> <span class=\"variable\">$uri</span>/ =404;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 前端应用配置</span></span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        root /home/lighthouse/workspace/small_u-shopping_mall/;  <span class=\"comment\"># 这是你上传 dist 文件夹的路径</span></span><br><span class=\"line\">        index index.html;</span><br><span class=\"line\">        try_files <span class=\"variable\">$uri</span> /index.html;  <span class=\"comment\"># Vue SPA路由需要此配置</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    location /shopmall/ &#123; </span><br><span class=\"line\">        <span class=\"built_in\">alias</span> /home/lighthouse/workspace/small_u-shopping_mall/;  <span class=\"comment\"># 这是你上传 dist 文件夹的路径 </span></span><br><span class=\"line\">        index index.html;</span><br><span class=\"line\">\ttry_files <span class=\"variable\">$uri</span> /index.html; </span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">    location /welcome &#123;</span><br><span class=\"line\">        <span class=\"built_in\">alias</span> /home/lighthouse/workspace/html/;</span><br><span class=\"line\">        index test.html;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    location /pet &#123;</span><br><span class=\"line\">        <span class=\"built_in\">alias</span> /home/lighthouse/workspace/html/liuhuan/;</span><br><span class=\"line\">        index pet.html;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\"># location /def/ &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">#    alias /home/lighthouse/workspace/frontend_def/dist/;</span></span><br><span class=\"line\">    <span class=\"comment\">#    index index.html;</span></span><br><span class=\"line\">    <span class=\"comment\">#    try_files $uri $uri/ /index.html;</span></span><br><span class=\"line\">    <span class=\"comment\"># &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">lighthouse@VM-0-8-ubuntu:~$ </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">不同的系统、平台的服务器具体配置流程可能有差异，</span><br><span class=\"line\"></span><br><span class=\"line\">需要根据需要安装相关依赖，以及进行相应的配置。</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n",
            "tags": [
                "linux部署前后端"
            ]
        }
    ]
}